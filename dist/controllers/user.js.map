{"version":3,"sources":["../../src/controllers/user.js"],"names":["UserController","register","req","res","next","userRegistration","checkBody","body","getValidationResult","then","val","Math","floor","random","send","phone","OTPS","smsResponse","_db","create","response","json","data","id","status","message","err","handleErrorResponse","login","findOne","where","verifyOTP","otp","controller"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;IAEaA,c,WAAAA,c;;;;;;;;;;;;;;0MAETC,Q,GAAW,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC3B,mCAAaC,gBAAb,CAA8BH,IAAII,SAAlC,EAA6CJ,IAAIK,IAAjD,EAAuDL,IAAIM,mBAAJ,EAAvD,EAAkFC,IAAlF,CAAuF,UAACF,IAAD,EAAU;AAC7F,oBAAIG,MAAMC,KAAKC,KAAL,CAAW,OAAOD,KAAKE,MAAL,KAAgB,IAAlC,CAAV;AACAN,qBAAK,MAAL,IAAeG,GAAf;AACA,kCAAQI,IAAR,CAAaP,KAAKQ,KAAlB,EAAyBR,KAAKS,IAA9B,EAAoCP,IAApC,CAAyC,UAACQ,WAAD,EAAiB;AACtD,0BAAKC,GAAL,CAASb,gBAAT,CAA0Bc,MAA1B,CAAiCZ,IAAjC,EAAuCE,IAAvC,CAA4C,UAACW,QAAD,EAAc;AACtDjB,4BAAIkB,IAAJ,CAAS,EAAEC,MAAM,EAACC,IAAGH,SAASG,EAAb,EAAR,EAA0BC,QAAQ,CAAlC,EAAqCC,SAAS,SAA9C,EAAT;AACH,qBAFD,EAEG,UAACC,GAAD;AAAA,+BAAS,MAAKC,mBAAL,CAAyBxB,GAAzB,EAA8BuB,GAA9B,CAAT;AAAA,qBAFH;AAGH,iBAJD,EAIG,UAACA,GAAD,EAAS;AACR,0BAAKC,mBAAL,CAAyBxB,GAAzB,EAA8BuB,GAA9B;AACH,iBAND;AAOH,aAVD,EAUG,UAACA,GAAD;AAAA,uBAAS,MAAKC,mBAAL,CAAyBxB,GAAzB,EAA8BuB,GAA9B,CAAT;AAAA,aAVH;AAWH,S,QAEDE,K,GAAQ,UAAC1B,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACxB,kBAAKc,GAAL,CAASb,gBAAT,CAA0BwB,OAA1B,CAAkC,EAAEC,OAAO,EAAEf,OAAOb,IAAIK,IAAJ,CAASQ,KAAlB,EAAT,EAAlC,EAAwEN,IAAxE,CAA6E,UAACW,QAAD,EAAc;AACvF,oBAAIA,QAAJ,EAAc;AACVjB,wBAAIkB,IAAJ,CAAS,EAAEC,MAAMF,QAAR,EAAkBI,QAAQ,CAA1B,EAA6BC,SAAS,SAAtC,EAAT;AACH,iBAFD,MAEO;AACH,0BAAKE,mBAAL,CAAyBxB,GAAzB,EAA8B,WAA9B;AACH;AACJ,aAND,EAMG,UAACuB,GAAD;AAAA,uBAAS,MAAKC,mBAAL,CAAyBxB,GAAzB,EAA8BuB,GAA9B,CAAT;AAAA,aANH;AAOH,S,QAEDK,S,GAAY,UAAC7B,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC5B,kBAAKc,GAAL,CAASb,gBAAT,CAA0BwB,OAA1B,CAAkC,EAAEC,OAAO,EAAEP,IAAIrB,IAAIK,IAAJ,CAASgB,EAAf,EAAmBP,MAAMd,IAAIK,IAAJ,CAASyB,GAAlC,EAAT,EAAlC,EAAsFvB,IAAtF,CAA2F,UAACW,QAAD,EAAc;AACrG,oBAAIA,QAAJ,EAAc;AACVjB,wBAAIkB,IAAJ,CAAS,EAAEG,QAAQ,CAAV,EAAaC,SAAS,SAAtB,EAAT;AACH,iBAFD,MAEO;AACH,0BAAKE,mBAAL,CAAyBxB,GAAzB,EAA8B,WAA9B;AACH;AACJ,aAND,EAMG,UAACuB,GAAD;AAAA,uBAAS,MAAKC,mBAAL,CAAyBxB,GAAzB,EAA8BuB,GAA9B,CAAT;AAAA,aANH;AAOH,S;;;;;;AAGL,IAAMO,aAAa,IAAIjC,cAAJ,EAAnB;kBACeiC,U","file":"user.js","sourcesContent":["import BaseAPIController from \"./BaseAPIController\";\nimport userProvider from '../providers/userProvider';\nimport _ from \"lodash\";\nimport sendSMS from './../service/sendSMS';\n\nexport class UserController extends BaseAPIController {\n\n    register = (req, res, next) => {\n        userProvider.userRegistration(req.checkBody, req.body, req.getValidationResult()).then((body) => {\n            var val = Math.floor(1000 + Math.random() * 9000);\n            body['OTPS'] = val;\n            sendSMS.send(body.phone, body.OTPS).then((smsResponse) => {\n                this._db.userRegistration.create(body).then((response) => {\n                    res.json({ data: {id:response.id}, status: 1, message: 'success' });\n                }, (err) => this.handleErrorResponse(res, err))\n            }, (err) => {\n                this.handleErrorResponse(res, err)\n            })\n        }, (err) => this.handleErrorResponse(res, err))\n    }\n\n    login = (req, res, next) => {\n        this._db.userRegistration.findOne({ where: { phone: req.body.phone } }).then((response) => {\n            if (response) {\n                res.json({ data: response, status: 1, message: 'success' })\n            } else {\n                this.handleErrorResponse(res, 'not found')\n            }\n        }, (err) => this.handleErrorResponse(res, err))\n    }\n\n    verifyOTP = (req, res, next) => {\n        this._db.userRegistration.findOne({ where: { id: req.body.id, OTPS: req.body.otp } }).then((response) => {\n            if (response) {\n                res.json({ status: 1, message: 'success' })\n            } else {\n                this.handleErrorResponse(res, 'not found')\n            }\n        }, (err) => this.handleErrorResponse(res, err))\n    }\n}\n\nconst controller = new UserController();\nexport default controller;"]}